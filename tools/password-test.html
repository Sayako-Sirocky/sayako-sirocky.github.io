<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
<title>密码检测工具集</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
html,body{height:100%}
body{background:#129c7c;padding:25px 20px;display:flex;flex-direction:column;transition:background .3s}
h1{font-size:22px;text-align:center;margin-bottom:15px;transition:color .3s;background:#fff;border-radius:8px;padding:4px 10px}
h2{font-size:18px;text-align:center;margin-bottom:10px;transition:color .3s}
.row-flex{display:flex;gap:20px;flex:1;min-height:0}
.col{flex:1;background:#fff;border-radius:12px;padding:15px;display:flex;flex-direction:column}
label{font-weight:600;margin-bottom:4px;font-size:14px}
input,textarea,select{width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;font-size:14px}
textarea{resize:vertical;min-height:60px;flex:1}
button{margin-top:8px;padding:6px 12px;border:none;border-radius:6px;background:#12cc99;color:#fff;font-size:14px;cursor:pointer}
button:hover{background:#129c7c}
.bar{height:6px;background:#e0e0e0;border-radius:3px;overflow:hidden;margin:6px 0}
.fill{height:100%;transition:width .3s}
.lev{text-align:center;font-weight:700;font-size:15px;margin-top:4px}
.tech{font-size:13px}
.row{display:flex;justify-content:space-between;margin-bottom:4px}
.warn{color:#ff4757;font-size:12px;margin-top:2px;display:none}
.chk-left{display:flex;align-items:center;margin:4px 0}
.chk-left input{margin-right:6px}
.multi-chk{display:flex;flex-wrap:wrap;gap:8px;font-size:14px}
@media(max-width:720px){.row-flex{flex-direction:column}}
</style>
</head>
<body>
<h1 id="title">密码强度·香农熵检测器</h1>

<div class="row-flex">
  <!-- 第一栏 -->
  <div class="col">
    <label for="pwd">输入密码</label>
    <input type="password" id="pwd" maxlength="63" placeholder="请输入或粘贴密码"/>
    <div class="warn" id="warnLen">长度1-63位</div>
    <div class="chk-left">
      <input type="checkbox" id="show"/><label>显示密码</label>
    </div>
    <div class="bar"><div class="fill" id="fill"></div></div>
    <div class="lev" id="lev">未输入</div>
    <div class="tech">
      <div class="row"><span>长度</span><span class="val" id="len">0</span></div>
      <div class="row"><span>字符集</span><span class="val" id="cs">0</span></div>
      <div class="row"><span>安全指数</span><span class="val" id="idx">0</span></div>
      <div class="row"><span>安全等级(bit)</span><span class="val" id="bits">0</span></div>
      <div class="row"><span>香农熵(bit)</span><span class="val" id="sh">0</span></div>
      <div class="row"><span>扣分</span><span class="val" id="deduct">0</span></div>
    </div>
  </div>

  <!-- 第二栏 -->
  <div class="col">
    <h2 id="sub1">指导意见</h2>
    <textarea id="guide" readonly>请输入密码后查看成分与建议…</textarea>
  </div>

  <!-- 第三栏 -->
  <div class="col">
    <h2 id="sub2">随机密码生成器</h2>
    <label>位数
      <select id="lenSel">
        <option>8</option><option>12</option><option selected>16</option><option>20</option><option>24</option><option>32</option>
      </select>
    </label>
    <label>字符集（可多选）</label>
    <div class="multi-chk">
      <label><input type="checkbox" value="lower" checked> 小写字母</label>
      <label><input type="checkbox" value="upper"> 大写字母</label>
      <label><input type="checkbox" value="num" checked> 数字</label>
      <label><input type="checkbox" value="special"> 特殊字符</label>
    </div>
    <button onclick="generate()">生成</button>
    <textarea id="genPwd" rows="2" readonly placeholder="点击生成…"></textarea>
    <button onclick="copyPwd()">复制到输入栏</button>
  </div>
</div>

<script>
/* --- 完整 TOP100 弱口令 --- */
const TOP100 = [
  "123456","password","123456789","12345678","12345","qwerty","abc123","football","monkey","letmein",
  "111111","1234","1234567890","dragon","baseball","iloveyou","trustno1","sunshine","master","hello",
  "freedom","whatever","shadow","superman","michael","mustang","access","696969","123123","666666",
  "computer","jordan","magnum","daniel","cookie","password1","hello123","guest","qwerty123","starwars",
  "football1","princess","cheese","welcome","login","admin","flower","loveme","sololetmein","dragon1",
  "sunshine1","master1","hello1","freedom1","shadow1","superman1","michael1","mustang1","access1","cookie1",
  "password12","hello1234","123321","qazwsx","passw0rd","abc1234","654321","jordan23","harley","batman",
  "andrew","tigger","sunshine","iloveu","2000","charlie","robert","thomas","hockey","ranger","daniel",
  "starwars","klaster","112233","george","asshole","computer","michelle","jessica","pepper","1111",
  "zxcvbn","555555","11111111","131313","freedom","777777","pass","fuck","maggie","159753","aaaaaa","ginger"
];

/* --- 拼音正则 --- */
const PINYIN_RE = /(a[io]?|ou?|e[inr]?|ang?|ng|[bmp](a[io]?|[aei]ng?|ei|ie?|ia[no]|o|u)|pou|me|m[io]u|[fw](a|[ae]ng?|ei|o|u)|fou|wai|[dt](a[io]?|an|e|[aeio]ng|ie?|ia[no]|ou|u[ino]?|uan)|dei|diu|[nl](a[io]?|ei?|[eio]ng|i[eu]?|i?ang?|iao|in|ou|u[eo]?|ve?|uan)|nen|lia|lun|[ghk](a[io]?|[ae]ng?|e|ong|ou|u[aino]?|uai|uang?)|[gh]ei|[jqx](i(ao?|ang?|e|ng?|ong|u)?|u[en]?|uan)|([csz]h?|r)([ae]ng?|ao|e|i|ou|u[ino]?|uan)|[csz](ai?|ong)|[csz]h(ai?|uai|uang)|zei|[sz]hua|([cz]h|r)ong|y(ao?|[ai]ng?|e|i|ong|ou|u[en]?|uan))/i;

/* --- 古代大数（每级×10000） --- */
const ANCIENT = ["","万","亿","兆","京","垓","秭","穣","沟","涧","正","载","极","恒河沙","阿僧只","那由他","不可思议","无量","大数"];
function ancient(n){
  if(n<1e12) return n.toLocaleString();
  let e = 0, base = 1e12;
  while(n >= base && e < ANCIENT.length - 1){
    e++;
    base *= 1e4;
  }
  return (n / Math.pow(1e12, Math.pow(1e4, e-1))).toFixed(2) + ANCIENT[e] + "(10^" + (12 + e*4) + ")";
}

/* --- 工具 --- */
const $ = id => document.getElementById(id);
function charsetSize(pwd){
  let f=0;
  for(const ch of pwd){
    const c=ch.codePointAt(0);
    if(c>0x7F) f|=16;
    else{
      if(/[a-z]/.test(ch)) f|=1;
      else if(/[A-Z]/.test(ch)) f|=2;
      else if(/[0-9]/.test(ch)) f|=4;
      else f|=8;
    }
  }
  let s=0;
  if(f&1) s+=26;
  if(f&2) s+=26;
  if(f&4) s+=10;
  if(f&8) s+=33;
  if(f&16) s+=128;
  return s||1;
}
function shannon(pwd){
  const freq={};
  for(const ch of pwd) freq[ch]=(freq[ch]||0)+1;
  let h=0;
  for(const k in freq){ const p=freq[k]/pwd.length; h-=p*Math.log2(p); }
  return h;
}
function isCommon(pwd){ return TOP100.includes(pwd.toLowerCase()); }
function hasPinyin(pwd){ return PINYIN_RE.test(pwd.toLowerCase()); }
function getLevel(bits,len){
  const base=16,factor=Math.max(1,Math.floor(len/base));
  const T=[16,32,46,61,76,91].map(t=>t*factor);
  if(bits<T[0]) return {lev:"极弱",col:"#ff4757"};
  if(bits<T[1]) return {lev:"弱",col:"#ffa502"};
  if(bits<T[2]) return {lev:"较弱",col:"#ffdd59"};
  if(bits<T[3]) return {lev:"中",col:"#05c46b"};
  if(bits<T[4]) return {lev:"较强",col:"#26de81"};
  if(bits<T[5]) return {lev:"强",col:"#0fbcf9"};
  return {lev:"极强",col:"#3742fa"};
}
function setTitleColors(col){
  ['title','sub1','sub2'].forEach(id=>$(id).style.color=col);
}

/* --- 主更新 --- */
function update(){
  const pwd=$('pwd').value;
  const len=pwd.length;
  if(!len){
    ['len','cs','idx','bits','sh','deduct','lev','fill'].forEach(id=>$(id).textContent='0');
    $('lev').textContent='未输入';
    $('fill').style.width='0%';
    $('warnLen').style.display='none';
    document.body.style.background='#129c7c';
    setTitleColors('#129c7c');
    $('guide').value='请输入密码后查看成分与建议…';
    return;
  }
  if(len>63){$('warnLen').style.display='block';return;}
  $('warnLen').style.display='none';

  const cs=charsetSize(pwd);
  const idx=Math.pow(cs,len);
  const bits=Math.log2(idx);
  const sh=shannon(pwd);

  /* 熵扣分公式：20/(0.01 + 香农熵) */
  const deduct = Math.round((20 / (0.01 + sh)) * 10) / 10;

  const finalScore = Math.max(0,bits-deduct);
  const {lev,col}=getLevel(finalScore,len);

  $('len').textContent=len;
  $('cs').textContent=cs;
  $('idx').textContent=idx>=1e12?ancient(idx):idx.toLocaleString();
  $('bits').textContent=bits.toFixed(2);
  $('sh').textContent=sh.toFixed(2);
  $('deduct').textContent=deduct.toFixed(1);
  $('lev').textContent=lev;
  let percent=Math.min(100,finalScore/(91*Math.max(1,Math.floor(len/16)))*100);
  $('fill').style.width=percent+'%';
  $('fill').style.background=col;
  document.body.style.background=col;
  setTitleColors(col);

  /* 精细化指导意见 */
  const hasLower=/[a-z]/.test(pwd);
  const hasUpper=/[A-Z]/.test(pwd);
  const hasNum=/\d/.test(pwd);
  const hasSpecial=/[^A-Za-z0-9]/.test(pwd);
  const hasPin=hasPinyin(pwd);
  const isCom=isCommon(pwd);
  let guide='';
  if(isCom){
    guide='⚠️ 属于常见弱口令，立即更换！';
  }else if(hasPin){
    guide='⚠️ 包含拼音/单词，降低熵值，建议加入随机字符与符号。';
  }else if(!hasLower){
    guide='❗ 缺少小写字母，建议加入。';
  }else if(!hasUpper){
    guide='❗ 缺少大写字母，建议加入。';
  }else if(!hasNum){
    guide='❗ 缺少数字，建议加入。';
  }else if(!hasSpecial){
    guide='❗ 缺少特殊字符，建议加入。';
  }else if(len<12){
    guide='⚠️ 长度不足12位，建议≥16位。';
  }else{
    guide='✅ 成分丰富，长度充足，继续保持！';
  }
  $('guide').value=guide;
}

/* --- 随机密码生成器 --- */
function generate(){
  const len=parseInt($('lenSel').value);
  const pool=[];
  document.querySelectorAll('.multi-chk input:checked').forEach(c=>{
    switch(c.value){
      case 'lower': pool.push(...'abcdefghijklmnopqrstuvwxyz'); break;
      case 'upper': pool.push(...'ABCDEFGHIJKLMNOPQRSTUVWXYZ'); break;
      case 'num': pool.push(...'0123456789'); break;
      case 'special': pool.push(...'!@#$%^&*()_+-=[]{}|;:,.<>?'); break;
    }
  });
  if(!pool.length){$('genPwd').value='请至少选择一项字符集';return;}
  let pwd='';
  for(let i=0;i<len;i++) pwd+=pool[Math.floor(Math.random()*pool.length)];
  $('genPwd').value=pwd;
}
function copyPwd(){
  const pwd=$('genPwd').value;
  if(!pwd || pwd.includes('请至少')) return;
  $('pwd').value=pwd;
  update();
}

/* 事件绑定 */
$('pwd').addEventListener('input',update);
$('show').addEventListener('change',e=> $('pwd').type=e.target.checked?'text':'password');
update();
</script>
</body>
</html>
